<div class="container">
  <div class="accordion my-3" id="accordion">
    <div class="accordion-item">
      <p class="accordion-header h2" id="searchAccordion">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#searchCollapse"
          aria-expanded="false" aria-controls="searchCollapse">
          æœå°‹
        </button>
      </p>
      <div id="searchCollapse" class="accordion-collapse collapse" aria-labelledby="searchAccordion" data-bs-parent="#accordion">
        <div class="accordion-body">
          {{!-- search bar --}}
          <form action="/search" method="POST" autocomplete="off" class="row g-3">
            <div class="col-12 col-sm-auto">
              <select class="form-select" name="field" required>
                <option disabled>æœå°‹ç¯„åœ</option>
                {{#each fieldMap}}
                <option value="{{@key}}" {{ifEquals this ../field}}>{{this}}</option>
                {{/each}}
              </select>
            </div>
            <div class="col-12 col-sm-8">
              <input type="text" name="keyword" id="userInput" class="form-control" placeholder="è¼¸å…¥é—œéµå­—" value="{{ keyword }}"
                aria-label="search by restaurant name" aria-describedby="searchButton" required>
            </div>
            <div class="col-12 col-sm-auto d-flex justify-content-between">
              {{#if clearResult}}
              <a href="/" class="btn btn-secondary" type="button" id="clearResultButton">çµæŸæœå°‹</a>
              {{/if}}
              <button class="btn btn-primary ms-2" type="submit" id="searchButton">æœå°‹</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="accordion-item">
      <p class="accordion-header h2" id="sortAccordion">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sortCollapse"
          aria-expanded="false" aria-controls="sortCollapse">
          æ’åº
        </button>
      </p>
      <div id="sortCollapse" class="accordion-collapse collapse" aria-labelledby="sortsortAccordion"
        data-bs-parent="#accordion">
        <div class="accordion-body">
          {{!-- sort --}}
          {{#if sort}}
          <select class="form-select" id="sort">
            <option disabled selected>è«‹é¸æ“‡æ’åºæ¢ä»¶</option>
            <option value="rating_asc">è©•åˆ†é«˜â†’ä½</option>
            <option value="rating_desc">è©•åˆ†ä½â†’é«˜</option>
            <option value="category">é¡å‹</option>
          </select>
          {{/if}}
        </div>
      </div>
    </div>
  </div>

  {{#if noResult}}
  <p>æŠ±æ­‰ï¼Œåœ¨{{ field }}æ¬„ä½æœå°‹ã€Œ{{ keyword }}ã€æ²’æœ‰ç›¸é—œçµæœ ğŸ˜¢</p>
  {{/if}}

  {{!-- restaurant cards --}}
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="cardsContainer">
    {{#each restaurants}}

    <div class="col">
      <div class="card">
        <div class="card-image" title="{{ this.name }}">
          <a href="/restaurant/{{ this._id }}" class="text-decoration-none">
            {{#if this.image}}
            <img src="{{toImage this.image.contentType this.image.data.buffer}}" class="card-img-top" alt="restaurant image">
            {{else}}
            <img src="{{ this.image_url }}" class="card-img-top" alt="restaurant image">
            {{/if}}
          </a>
        </div>
        <div class="card-body">
          <a href="/restaurant/{{ this._id }}" class="card-title h5 text-decoration-none d-block" title="{{ this.name }}">{{ this.name }}</a>
          <span class="badge bg-info">{{ this.category }}</span>
          <span class="badge bg-warning text-dark"><i class="bi bi-star-fill me-1"></i>{{ this.rating }}</span>
          <a href="/restaurant/{{ this._id }}/edit" class="badge bg-secondary text-decoration-none">
            <i class="bi bi-pencil-square"></i>
          </a>
          <a type="button" class="badge bg-light text-decoration-none"
          data-bs-toggle="modal" data-bs-target="#modal{{ this._id }}">
            <i class="bi bi-trash-fill"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal{{ this._id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <p class="modal-title h5">{{ this.name }}</p>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            ç¢ºèªè¦åˆªé™¤é¤å»³ã€Œ{{ this.name }}ã€å—ï¼Ÿ
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">å–æ¶ˆ</button>
            <form action="/restaurant/{{ this._id }}?_method=DELETE" method="POST">
              <button type="submit" class="btn btn-secondary">ç¢ºèªåˆªé™¤</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {{/each}}
  </div>

  {{!-- new --}}
  <a href="/restaurant/new">
    <span class="add-restaurant"></span>
  </a>
</div>