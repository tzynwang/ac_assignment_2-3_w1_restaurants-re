<div class="container">
  <form action="/search" method="POST" autocomplete="off" class="mb-3">
    <div class="input-group">
      <select class="form-select" name="field" required>
        <option disabled>æœå°‹ç¯„åœ</option>
        {{#each fieldMap}}
        <option value="{{@key}}" {{ifEquals this ../field}}>{{this}}</option>
        {{/each}}
      </select>
      <input type="text" name="keyword" id="userInput" class="form-control" placeholder="è¼¸å…¥é—œéµå­—" value="{{ keyword }}"
        aria-label="search by restaurant name" aria-describedby="searchButton" required>
      {{#if clearResult}}
      <a href="/" class="btn btn-secondary" id="clearResultButton">çµæŸæœå°‹</a>
      {{/if}}
      <button class="btn btn-primary ms-2" type="submit" id="searchButton">æœå°‹</button>
    </div>
  </form>
  
  {{#if sort}}
  <div class="mb-3">
    <select class="form-select" id="sort">
      <option disabled selected>è«‹é¸æ“‡æ’åºæ¢ä»¶</option>
      <option value="rating_asc">è©•åˆ†é«˜â†’ä½</option>
      <option value="rating_desc">è©•åˆ†ä½â†’é«˜</option>
      <option value="category">é¡å‹</option>
    </select>
  </div>
  {{/if}}

  {{#if noResult}}
  <p>æŠ±æ­‰ï¼Œåœ¨{{ field }}æ¬„ä½æœå°‹ã€Œ{{ keyword }}ã€æ²’æœ‰ç›¸é—œçµæœ ğŸ˜¢</p>
  {{/if}}

  {{!-- restaurant cards --}}
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="cardsContainer">
    {{#each restaurants}}

    <div class="col">
      <div class="card">
        <div class="card-image" title="{{ this.name }}">
          <a href="/restaurant/{{ this._id }}" class="text-decoration-none">
            {{#if this.image}}
            <img src="{{toImage this.image.contentType this.image.data.buffer}}" class="card-img-top" alt="restaurant image">
            {{else}}
            <img src="{{ this.image_url }}" class="card-img-top" alt="restaurant image">
            {{/if}}
          </a>
        </div>
        <div class="card-body">
          <a href="/restaurant/{{ this._id }}" class="card-title h5 text-decoration-none d-block" title="{{ this.name }}">{{ this.name }}</a>
          <span class="badge bg-info">{{ this.category }}</span>
          <span class="badge bg-warning text-dark"><i class="bi bi-star-fill me-1"></i>{{ this.rating }}</span>
        </div>
      </div>
      <div class="mt-1 d-flex align-items-center justify-content-end">
        <a href="/restaurant/{{ this._id }}/edit" class="text-decoration-none me-2">
          <i class="bi bi-pencil-square"></i> ç·¨è¼¯
        </a>
        <a href="/restaurant/{{ this._id }}" class="text-decoration-none me-2">
          <i class="bi bi-search"></i> è©³ç´°
        </a>
        <a type="button" class="text-decoration-none btn btn-light" data-bs-toggle="modal" data-bs-target="#modal{{ this._id }}">
          <i class="bi bi-trash-fill"></i> åˆªé™¤
        </a>
      </div>
    </div>

    <div class="modal fade" id="modal{{ this._id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <p class="modal-title h5">{{ this.name }}</p>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            ç¢ºèªè¦åˆªé™¤é¤å»³ã€Œ{{ this.name }}ã€å—ï¼Ÿ
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">å–æ¶ˆ</button>
            <form action="/restaurant/{{ this._id }}?_method=DELETE" method="POST">
              <button type="submit" class="btn btn-secondary">ç¢ºèªåˆªé™¤</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {{/each}}
  </div>

  {{!-- new --}}
  <a href="/restaurant/new">
    <span class="add-restaurant"></span>
  </a>
</div>